<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ANNUAL RECITAL 2025</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    body { 
      font-family: Arial, sans-serif; 
      text-align: center; 
      margin: 0; 
      padding: 20px; 
    }
    h1 { 
      margin-bottom: 5px; 
      font-size: 2rem; 
    }
    .header-info {
      font-size: 0.95rem;
      line-height: 1.5;
      margin-bottom: 20px;
      text-align: center;
    }
    .header-info .subtitle {
      font-weight: bold;
      margin: 5px 0;
    }
    .header-info p {
      margin: 5px 0;
    }
    .header-info strong {
      font-weight: bold;
    }
    hr {
      border: none;
      border-top: 1px solid #ddd;
      margin: 20px auto;
      width: 80%;
    }
    #searchInput { 
      width: 60%; 
      max-width: 640px; 
      padding: 10px; 
      margin: 20px 0; 
      text-align: center; 
    }
    .table-wrap { 
      max-height: 72vh; 
      overflow: auto; 
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px; 
    }
    th, td { 
      border: 1px solid #ddd; 
      padding: 8px; 
      text-align: center; 
      vertical-align: top; 
    }
    th { 
      background-color: #f2f2f2; 
      position: sticky; 
      top: 0; 
      z-index: 1; 
    }
    .bold { font-weight: bold; }
    .muted { color: #777; }
    a { text-decoration: underline; }
  </style>
</head>
<body>

  <h1>ATJ ANNUAL RECITAL 2025</h1>
  <div class="header-info">
    <p class="subtitle">REHEARSAL & PERFORMANCE SCHEDULE:</p>
    <p><strong>Combined Rehearsals â€“ at ATJ outlets:</strong><br>
  Forum The Shopping Mall: 583 Orchard Road, #02-05/06/07, Singapore 238884<br>
  I12 Katong: 112 East Coast Road, #03-14/15, Singapore 428802<br>
  10 Winstedt Road: #01-05/06/07/08, Singapore 227977<br>
  Prinsep: 36 Prinsep St, Level 4, Singapore 188648
</p>
      <strong>In-Studio Tech Rehearsals:</strong><br>
      Performance & Training Centre, 36 Prinsep St, 04-01, S188638
    </p>
    <p>
      <strong>Mediacorp Tech & Show Days:</strong><br>
      The Theatre at Mediacorp, 1 Stars Avenue, S138507
    </p>
  </div>

  <hr>

  <input type="text" id="searchInput" placeholder="Search..." />

  <div class="table-wrap">
    <table id="data-table">
      <thead>
        <tr id="header-row"></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <p id="status" class="muted"></p>

  <script>
    $(function () {
      // Keys MUST match your CSV headers exactly
      const COLUMNS = [
        { key: "Event Type",         label: "Event Type" },
        { key: "Event Day & Date",   label: "Event Day & Date", bold: true },
        { key: "Student Name",       label: "Student Name" },
        { key: "Event Location",     label: "Event Location" },
        { key: "Reporting Time",     label: "Reporting Time", bold: true },
        { key: "Event Time",         label: "Event Time" },
        { key: "Dismissal Time",     label: "Dismissal Time" },
        { key: "Costume",            label: "Costume" },            
        { key: "Footwear",           label: "Footwear" },
        { key: "Makeup",             label: "Makeup" },             
        { key: "Hair",               label: "Hair" },               
        { key: "Dance Routine",      label: "Dance Routine", bold: true },
        { key: "Class Name",         label: "Class Name" },
        { key: "Remarks",            label: "Remarks" }
      ];

      // Columns that should render as a fixed-label link if a URL is present
      const LINK_LABELS = {
        "Costume": "Costume Link",
        "Makeup": "Makeup Tutorial",
        "Hair": "Hair Tutorial"
      };
      const LINK_COLUMNS = new Set(Object.keys(LINK_LABELS));

      const URL_RE = /https?:\/\/[^\s<>"')]+/i;
      const $status = $("#status");

      function normalize(v) {
        return String(v == null ? "" : v).toLowerCase().trim();
      }

      function escHtml(s) {
        return String(s)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function escAttr(s) {
        return escHtml(s);
      }

      function firstUrl(text) {
        const m = URL_RE.exec(String(text || ""));
        return m ? m[0] : null;
      }

      function buildHeader() {
        const $row = $("#header-row").empty();
        COLUMNS.forEach(col => $row.append(`<th>${col.label}</th>`));
      }

      function renderCell(colKey, raw) {
        const val = raw == null ? "" : String(raw).trim();
        if (!val) return "N/A";

        if (LINK_COLUMNS.has(colKey)) {
          const url = firstUrl(val);
          if (url) {
            const label = LINK_LABELS[colKey] || "Link";
            return `<a href="${escAttr(url)}" target="_blank" rel="noopener noreferrer" title="${escAttr(url)}">${escHtml(label)}</a>`;
          }
        }
        // default plain text (preserve newlines)
        return escHtml(val).replace(/\n/g, "<br>");
      }

      function renderTable(rows) {
        const $tbody = $("#data-table tbody").empty();

        if (!rows || rows.length === 0) {
          $tbody.append(
            `<tr><td colspan="${COLUMNS.length}" class="muted">No rows to display.</td></tr>`
          );
          return;
        }

        rows.forEach(row => {
          const $tr = $("<tr>");
          COLUMNS.forEach(col => {
            const html = renderCell(col.key, row[col.key]);
            $tr.append(`<td class="${col.bold ? "bold" : ""}">${html}</td>`);
          });
          $tbody.append($tr);
        });
      }

      function filterRows(rows, query) {
        if (!query) return rows;
        return rows.filter(row =>
          COLUMNS.some(col => normalize(row[col.key]).includes(query))
        );
      }

      // Build header and fetch data
      buildHeader();

      <script>
  // Build header and fetch CSV directly
  buildHeader();

  function parseCSV(text) {
    const lines = text.split(/\r?\n/).filter(Boolean);
    const headers = lines[0].split(",");
    return lines.slice(1).map(line => {
      const cols = line.split(",");
      const row = {};
      headers.forEach((h, i) => row[h.trim()] = cols[i] || "");
      return row;
    });
  }

  const CSV_URL = "https://docs.google.com/spreadsheets/d/1XFHNeTBRvbO9Hu3rt2Sro2vF9sHS_wW6wzH35bJtgu0/export?format=csv&gid=785015495";

  $.ajax({ url: CSV_URL, dataType: "text" })
    .done(function (csvText) {
      const rows = parseCSV(csvText);
      renderTable(rows);

      $("#searchInput").on("input", function () {
        const q = normalize($(this).val());
        renderTable(filterRows(rows, q));
      });

      $("#status").text("");
    })
    .fail(function () {
      $("#status").text("Failed to load CSV data.");
      renderTable([]);
    });
</script>


        .done(function (rows) {
          if (!Array.isArray(rows)) {
            $status.text("Unexpected data format from server.");
            renderTable([]);
            return;
          }
          renderTable(rows);
          $("#searchInput").on("input", function () {
            const q = normalize($(this).val());
            renderTable(filterRows(rows, q));
          });
          $status.text("");
        })
        .fail(function (xhr) {
          let msg = "Failed to load data.";
          try {
            const err = JSON.parse(xhr.responseText || "{}");
            if (err.error) msg += ` ${err.error}`;
          } catch (_) {}
          $status.text(msg);
          renderTable([]);
        });
    });
  </script>

</body>
</html>



