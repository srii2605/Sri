<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ATJ ANNUAL RECITAL 2025</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#ffffff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --badge-green-bg:#ecfdf5; --badge-green:#065f46;
      --badge-purple-bg:#f5f3ff; --badge-purple:#5b21b6;
      --badge-blue-bg:#eff6ff; --badge-blue:#1e40af;
      --row-alt:#fafafa;
      --chip-bg:#f3f4f6; --chip-on:#111827; --chip-active-bg:#111827; --chip-active:#ffffff;
      --hl:#fff3bf; --card-bg:#ffffff;
      --fs-th:13px; --fs-td:15px; --fs-label:12px;
    }

    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

    .container{max-width:100%;margin:24px auto;padding:0 16px}

    h1{font-size:32px;font-weight:800;margin:0 0 6px}
    .underline-title{
      font-size:18px;font-weight:700;margin:4px 0 16px;line-height:1.2;
      display:block;position:relative
    }
    .underline-title::after{
      content:"";display:block;height:3px;margin-top:6px;
      background:linear-gradient(90deg,#111827,transparent 80%);
      border-radius:2px;
    }

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin:18px 0 12px}
    .card{border:1px solid var(--line);border-radius:14px;padding:16px;background:var(--card-bg)}
    .card h3{margin:0 0 6px;font-size:18px}
    .muted{color:var(--muted);font-size:14px;line-height:1.45}
    .muted div{margin:4px 0}

    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin:16px 0}
    .search{flex:1 1 420px;max-width:640px;padding:10px 12px;border:1px solid var(--line);border-radius:12px;font-size:14px}

    .chips{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .chip{
      display:inline-flex;align-items:center;gap:.4rem;
      border:1px solid var(--line);background:var(--chip-bg);color:var(--chip-on);
      border-radius:10px;padding:8px 10px;font-size:var(--fs-th);font-weight:600;
      cursor:pointer;user-select:none
    }
    .chip.active{background:var(--chip-active-bg);color:var(--chip-active);border-color:var(--chip-active-bg)}

    .table-wrap{display:block;overflow:visible;margin-top:12px}
    table{width:100%;border-collapse:separate;border-spacing:0;table-layout:auto}
    thead th{position:sticky;top:0;background:#f8f8f8;z-index:1;text-align:left;
      font-weight:600;font-size:var(--fs-th);padding:12px;border-bottom:1px solid var(--line)}
    tbody td{padding:12px;border-bottom:1px solid var(--line);font-size:var(--fs-td);
      vertical-align:top;white-space:normal;word-break:keep-all;
      overflow-wrap:break-word;hyphens:none;line-height:1.35}
    tbody tr:nth-child(even){background:var(--row-alt)}

    /* Bold Event Location */
    td:nth-child(4){font-weight:700}

    /* Italic Class Name, max 2 lines */
    td:nth-child(11){
      font-style:italic;
      max-width:220px;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .badge{display:inline-flex;align-items:center;
      padding:4px 8px;border-radius:999px;font-weight:700;font-size:12px;line-height:1;white-space:nowrap}
    .badge.green{background:var(--badge-green-bg);color:var(--badge-green)}
    .badge.purple{background:var(--badge-purple-bg);color:var(--badge-purple)}
    .badge.blue{background:var(--badge-blue-bg);color:var(--badge-blue)}

    .helper{color:var(--muted);font-size:13px;margin:10px 0 0;text-align:center}
    .hidden{display:none}
    a.link-pill{font-weight:600;text-decoration:none;border-bottom:1px dashed currentColor}
    mark{background:var(--hl);padding:0 .1em;border-radius:2px}

    /* Mobile view */
    @media (max-width:900px){
      h1{font-size:24px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
      .underline-title{font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
      .grid{grid-template-columns:1fr;gap:16px}
      .table-wrap{display:none}
      #cards{display:grid;gap:12px;margin-top:12px}
    }

    @media print{
      .controls,.grid,#cards{display:none}
      .container{max-width:unset;margin:0;padding:0}
      thead th,tbody td{font-size:11px;padding:6px}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ATJ ANNUAL RECITAL 2025</h1>
    <div class="underline-title">REHEARSAL &amp; PERFORMANCE SCHEDULE</div>

    <!-- Split header -->
    <div class="grid">
      <div class="card">
        <h3>Combined Rehearsals - at ATJ outlets:</h3>
        <div class="muted">
          <div><strong>Forum The Shopping Mall:</strong> 583 Orchard Road, #02‚Äì05/06/07, Singapore 238884</div>
          <div><strong>I12 Katong:</strong> 112 East Coast Road, #03‚Äì14/15, Singapore 428802</div>
          <div><strong>10 Winstedt Road:</strong> #01‚Äì05/06/07/08, Singapore 227977</div>
          <div><strong>Prinsep:</strong> 36 Prinsep St, Level 4, Singapore 188648</div>
        </div>
      </div>
      <div class="card">
        <h3>In-Studio &amp; Mediacorp Technical Rehearsals:</h3>
        <div class="muted">
          <div><strong>In-Studio Tech:</strong> Performance &amp; Training Centre, 36 Prinsep St, 04‚Äì01, S188638</div>
          <div><strong>Mediacorp Tech &amp; Shows:</strong> The Theatre at Mediacorp, 1 Stars Ave, S138507</div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls">
      <input id="search" class="search" placeholder="Search all columns‚Ä¶" aria-label="Search all columns"/>
    </div>

    <!-- Chips -->
    <div class="chips">
      <div class="chip active" data-filter="all">‚≠ê All</div>
      <div class="chip" data-filter="combined">üë• Combined Rehearsal</div>
      <div class="chip" data-filter="tech">üé≠ Technical Rehearsal</div>
      <div class="chip" data-filter="show">üé¨ Show Day</div>
    </div>

    <div id="msg" class="helper hidden"></div>

    <!-- Desktop table -->
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Event Type</th><th>Event Day &amp; Date</th><th>Student Name</th>
            <th>Event Location</th><th>Reporting Time</th><th>Event Time</th>
            <th>Dismissal Time</th><th>Full Look Guide</th><th>Footwear</th>
            <th>Dance Routine</th><th>Class Name</th><th>Remarks</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- Mobile cards -->
    <div id="cards"></div>
  </div>

  <script>
    const BASE_CSV_URL="https://docs.google.com/spreadsheets/d/1XFHNeTBRvbO9Hu3rt2Sro2vF9sHS_wW6wzH35bJtgu0/export?format=csv&gid=785015495";
    const COLS=['Event Type','Event Day & Date','Student Name','Event Location',
      'Reporting Time','Event Time','Dismissal Time','Full Look Guide','Footwear',
      'Dance Routine','Class Name','Remarks'];
    const tbody=document.getElementById('tbody');
    const cards=document.getElementById('cards');
    const msg=document.getElementById('msg');
    const searchEl=document.getElementById('search');
    const chips=Array.from(document.querySelectorAll('.chip'));
    let RAW=[],FILTER='all',QUERY='';

    function csvToRows(t){const r=[];let e=[],n="",i=0,o=!1;for(;i<t.length;){const s=t[i];if(o)if('"'===s&&'"'===t[i+1])n+='"',i+=2;else if('"'===s)o=!1,i++;else{n+=s,i++}else'"'===s?(o=!0,i++):","===s?(e.push(n),n="",i++):"\n"===s||"\r"===s?("\r"===s&&"\n"===t[i+1]&&i++,e.push(n),r.push(e),e=[],n="",i++):(n+=s,i++)}return n.length||e.length?(e.push(n),r.push(e)):r}
    function csvToObjects(t){const r=csvToRows(t);if(!r.length)return[];const e=r[0].map((t=>t.trim()));return r.slice(1).map((r=>{const n={};return e.forEach(((e,i)=>{n[e]=r[i]??""})),n}))}
    function escHtml(t){return String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}
    function escapeRegExp(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}
    function withHighlight(t,r){if(!r)return escHtml(t||"");const e=escHtml(t||""),n=new RegExp(`(${escapeRegExp(r)})`,"ig");return e.replace(n,"<mark>$1</mark>")}
    function formatFullLook(t){if(!t)return"";const r=String(t).trim();return/^https?:\/\//i.test(r)||/^www\./i.test(r)?`<a class="link-pill" href="${escHtml(r.startsWith("www.")?"https://"+r:r)}" target="_blank">Open link</a>`:escHtml(r)}
    function asBadge(t){const r=String(t||"").toLowerCase();return r.includes("combined rehearsal")?`<span class="badge green">${escHtml(t)}</span>`:r.includes("in-studio")||r.includes("mediacorp")?`<span class="badge purple">${escHtml(t)}</span>`:r.includes("show")?`<span class="badge blue">${escHtml(t)}</span>`:`<span class="badge">${escHtml(t)}</span>`}
    function passesFilter(t){const r=String(t["Event Type"]||"").toLowerCase();return"combined"===FILTER?r.includes("combined rehearsal"):"tech"===FILTER?r.includes("in-studio")||r.includes("mediacorp"):"show"===FILTER?r.includes("show"):!0}
    function matchesQuery(t){if(!QUERY)return!0;const r=QUERY.toLowerCase();return COLS.some((e=>String(t[e]||"").toLowerCase().includes(r)))}
    function renderTable(r){tbody.innerHTML=r.length?r.map((r=>`<tr>
      <td>${asBadge(r["Event Type"])}</td>
      <td>${withHighlight(r["Event Day & Date"],QUERY)}</td>
      <td>${withHighlight(r["Student Name"],QUERY)}</td>
      <td><strong>${withHighlight(r["Event Location"],QUERY)}</strong></td>
      <td>${withHighlight(r["Reporting Time"],QUERY)}</td>
      <td>${withHighlight(r["Event Time"],QUERY)}</td>
      <td>${withHighlight(r["Dismissal Time"],QUERY)}</td>
      <td>${formatFullLook(r["Full Look Guide"])}</td>
      <td>${withHighlight(r["Footwear"],QUERY)}</td>
      <td>${withHighlight(r["Dance Routine"],QUERY)}</td>
      <td><em>${withHighlight(r["Class Name"],QUERY)}</em></td>
      <td>${withHighlight(r["Remarks"],QUERY)}</td>
    </tr>`)).join(""):`<tr><td colspan="12" class="muted">No results</td></tr>`}
    function renderCards(r){cards.innerHTML=r.length?r.map((r=>`<div class="row-card">
      <div class="row-head"><div class="row-title">${withHighlight(r["Student Name"],QUERY)}</div>
      <div class="chip-inline">${asBadge(r["Event Type"])}</div></div>
      <div class="row-sub">${withHighlight(r["Event Day & Date"],QUERY)}</div>
      <div class="row-grid">
        <div class="item"><span class="label">Location</span><strong>${withHighlight(r["Event Location"],QUERY)}</strong></div>
        <div class="item"><span class="label">Full Look Guide</span>${formatFullLook(r["Full Look Guide"])}</div>
        <div class="item"><span class="label">Footwear</span>${withHighlight(r["Footwear"],QUERY)}</div>
        <div class="item"><span class="label">Dance Routine</span>${withHighlight(r["Dance Routine"],QUERY)}</div>
        <div class="item"><span class="label">Class Name</span><em>${withHighlight(r["Class Name"],QUERY)}</em></div>
      </div>
      <div class="times">
        <div class="item"><span class="label">Reporting Time</span>${withHighlight(r["Reporting Time"],QUERY)}</div>
        <div class="item"><span class="label">Event Time</span>${withHighlight(r["Event Time"],QUERY)}</div>
        <div class="item"><span class="label">Dismissal Time</span>${withHighlight(r["Dismissal Time"],QUERY)}</div>
      </div>
      ${r["Remarks"]?`<div class="remark"><span class="label">Remarks</span>${withHighlight(r["Remarks"],QUERY)}</div>`:""}
    </div>`)).join(""):`<div class="helper">No results</div>`}
    function render(){const r=RAW.filter((r=>passesFilter(r)&&matchesQuery(r)));renderTable(r),renderCards(r)}
    async function load(){try{msg.classList.add("hidden"),msg.textContent="";const r=await fetch(`${BASE_CSV_URL}&cachebust=${Date.now()}`,{cache:"no-store"});if(!r.ok){const t=await r.text();throw new Error(`HTTP ${r.status} ‚Äì ${t.slice(0,200)}`)}const t=await r.text(),e=csvToObjects(t);RAW=e.map((t=>{const r={};return COLS.forEach((e=>r[e]=t[e]??"")),r})),render()}catch(r){msg.textContent="Failed to load data.";msg.classList.remove("hidden"),tbody.innerHTML=`<tr><td colspan="12" class="muted">${escHtml(r.message)}</td></tr>`}}
    searchEl.addEventListener("input",(t=>{QUERY=t.target.value.trim(),render()}));
    chips.forEach((t=>{t.addEventListener("click",(()=>{chips.forEach((t=>{t.classList.remove("active"),t.setAttribute("aria-selected","false")})),
    t.classList.add("active"),t.setAttribute("aria-selected","true"),FILTER=t.dataset.filter,render()}))}));
    load();
  </script>
</body>
</html>
